---
- name: Assure {{ org_name }} organization is present"
  awx.awx.organization:
    name: "{{ org_name }}"
    state: present

- name: Assure that {{ project_name }} exists
  awx.awx.project:
    name: "{{ project_name }}"
    state: present
    organization: "{{ org_name }}"
    local_path: openbmc
    scm_type: manual    

- name: Assure that {{ inv_name }} exists
  awx.awx.inventory:
    name: "{{ inv_name }}"
    organization: "{{ org_name }}"  
    state: present  
    variables: 
        technical_state_path: /mnt
        forceoff: true
        reboot: true
        ntp_server_ip: 127.0.0.1
        ntp_server_sync: NTP
        rsyslog_server_ip: 0.0.0.0
        rsyslog_server_port: 514
        reboot_countdown: 2
        poweron_countdown: 5
        activating_countdown: 30
        poweroff_countdown: 5
        reboot_maxretries: 10
        poweron_maxretries: 10
        activating_maxretries: 10
        poweroff_maxretries: 10
        token_timeout: 5

- name: Add 10.22.89.186 host
  awx.awx.host:
    name: 10.22.89.186
    inventory: "{{ inv_name }}"
    state: present
    variables:
      baseuri: "{{ host }}"
      username: root
      password: "Sdd@atos"

- name: Add {{group_name}} group
  awx.awx.group:
    name: "{{ group_name }}"
    inventory: "{{ inv_name }}"
    state: present
    hosts: 
      - 10.22.89.186

- name: Create Job Template Get BMC State
  awx.awx.job_template:
    name: State BMC
    description: Get BMC State
    inventory: "{{ inv_name }}"
    project: "{{ project_name }}"
    playbook: get_bmc_state.yml
    job_type: run
    verbosity: 0
    state: present

    
  